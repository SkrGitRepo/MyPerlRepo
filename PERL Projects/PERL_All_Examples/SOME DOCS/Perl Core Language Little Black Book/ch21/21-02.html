<HTML>
<HEAD>
<META name=vsisbn content="1576104265">
<META name=vstitle content="Perl Core Language Little Black Book">
<META name=vsauthor content="Steven Holzner">
<META name=vspublisher content="The Coriolis Group">
<META name=vspubdate content="03/01/99">
<META name=vscategory content="Web and Software Development: Open Source Development: Languages: Perl,Web and Software Development: Programming, Scripting, and Markup Languages: Perl">





<TITLE>Perl Core Language Little Black Book:CGI: Multiuser Chat, Cookies, And Games</TITLE>

<!-- HEADER -->

<STYLE type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
</STYLE>

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
         var Win = window.open(url,"displayWindow",'width=' + width +',height=' + height + ',resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</script>
<SCRIPT>
<!--
function popUp(url) {
        var Win = window.open(url,"displayWindow",'width=400,height=300,resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</SCRIPT>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//-->
</script>

<SCRIPT LANGUAGE="JavaScript">
<!--
var axel = Math.random() + "";
var ord = axel * 1000000000000000000 + "?";

//This part of script alleviates a Netscape document.write bug
<!-- 
NS4 = document.layers;
if (NS4) {
origWidth = innerWidth;
origHeight = innerHeight;
}
function reDo() {
if (innerWidth != origWidth || innerHeight != origHeight) 
location.reload();
}
if (NS4) onresize = reDo;
//-->
</SCRIPT> 
</HEAD>

<body background="/images/back.jpg" bgcolor="#FFFFFF" link="#003399" alink="#FF0000" vlink="#003399" topmargin=0 leftmargin=0 marginheight=0 marginwidth=0>

<table bgcolor="#003366" width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr valign="top">
		<td height="95">
		&nbsp;&nbsp;<a href="http://www.earthweb.com" target="resource window"><img src="/images/ew_logo.jpg" width="82" height="58" alt="EarthWeb" border="0"></a>&nbsp;&nbsp;&nbsp;</td>
		<td height=95">
		<table width="100%">
			<tr valign="top">
			<td bgcolor="#003366" nowrap>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<NOLAYER>');
document.write('<IFRAME SRC="http://ad.doubleclick.net/adi/itk.earthweb.dart/b_soft_dev;a=b_soft_dev1;sz=468x60;ord=' + ord + '" width="468" height="60" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no">');
document.write('<A HREF="http://ad.doubleclick.net/jump/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev1;sz=468x60;ord=' + ord + '" target="_top"><IMG SRC="http://ad.doubleclick.net/ad/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev1;sz=468x60;ord=' + ord + '" border=0 height="60" width="468"></A>');
document.write('</IFRAME>');
document.write('</NOLAYER>');
document.write('<ILAYER id="layer1" visibility="hidden" width=468 height=60></ILAYER>');
//-->
</SCRIPT>
			</td>
			<td bgcolor="#003366" nowrap>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<NOLAYER>');
document.write('<IFRAME SRC="http://ad.doubleclick.net/adi/itk.earthweb.dart/b_soft_dev;a=b_soft_dev4;sz=160x60;ord=' + ord + '" width="160" height="60" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no">');
document.write('<A HREF="http://ad.doubleclick.net/jump/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev4;sz=160x60;ord=' + ord + '" target="_top"><IMG SRC="http://ad.doubleclick.net/ad/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev4;sz=160x60;ord=' + ord + '" border=0 height="60" width="160"></A>');
document.write('</IFRAME>');
document.write('</NOLAYER>');
document.write('<ILAYER id="layer4" visibility="hidden" width=160 height=60></ILAYER>');
//-->
</SCRIPT>
			</td>
			<td bgcolor="#003366" nowrap><a href="ITKN1a2b3c4d5e6f7g8h9idefcon4.html"><img src="/images/dotclear.gif" border="0" height="1" width="1" align="left"></a></td>
			</tr></table><br></td>
	</tr>
		
<!-- 	<tr>
		<td height="1" colspan="3" bgcolor="#003366"><img src="/images/dotclear.gif" border=0 alt=""></td>
	</tr> -->
</table>

<!-- END HEADER -->


<!-- BEGIN SUB HEADER -->

<table bgcolor="#003366" cellpadding="0" cellspacing="0" border="0" width="100%">

<!-- ITK TOPNAV -->
	
	<tr>
		<td align="left" valign="top" nowrap><a href="/index2.html"><img src="/images/top_tabs/home_off.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/accountinfo.gif" alt="Account Info" border="0"></a><!--<a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe.gif" alt="Subscribe" border="0"></a>--><a href="/PSUser/psuserauth.htm?cmd=login&URI=/"><img src="/images/top_tabs/login.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search.gif" alt="Search" border="0"></a><a href="/PSUser/EWIPOMain.html"><img src="/images/top_tabs/my_itknowledge.gif" alt="My ITKnowledge" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	
<!-- END of ITK TOPNAV -->

<!-- ITK LOGO and newsletter sign up -->

</table>
	
<table cellpadding="0" cellspacing="0" border="0" width="100%">

	<tr>
		<td align="left" valign="top" nowrap><img src="/images/itk_logo_sm.jpg" alt="" border="0"></td>
		<td align="right"><font face="verdana, sans-serif" size="1">

<script language="JavaScript">
<!-- 

var days = new Array(8);
days[1] = "Sunday";
days[2] = "Monday";
days[3] = "Tuesday";
days[4] = "Wednesday";
days[5] = "Thursday";
days[6] = "Friday";
days[7] = "Saturday";

var months = new Array(13);
months[1] = "January";
months[2] = "February";
months[3] = "March";
months[4] = "April";
months[5] = "May";
months[6] = "June";
months[7] = "July";
months[8] = "August";
months[9] = "September";
months[10] = "October";
months[11] = "November";
months[12] = "December";

var dateObj = new Date()
var wday = days[dateObj.getDay() + 1]
var lmonth = months[dateObj.getMonth() + 1]
var date = dateObj.getDate()
var fyear = dateObj.getYear()
if (fyear <1000) fyear += 1900;
document.write(wday + ", " + lmonth + " " + date + ", " + fyear)
                
//-->
</script>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<br><br>


		 </td>
	</tr>
	</table>

<!-- END ITK LOGO and newsletter sign up-->
	
<!-- begin of ITK left NAV -->

<!-- BEGIN LEFT NAVBAR -->

<!-- BEGIN LEFT NAVBAR -->

	<table border="0" cellpadding="0" cellspacing="0">
	
	
		<tr>
		<td width="145" valign="top" align="left" rowspan=8>
		
	<!-- KEYWORD SEARCH -->	
<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//-->
</script>
	
	
	<form name="keyword" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewkwk2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<img src="/images/keyword_searcha.gif" vspace="5" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="corpitk_p2">
<INPUT type="hidden" name="altcoll" value="allbooks_p2">
<INPUT type="hidden" name="topics" value="itk_www">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="vspubdate desc score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vsisbn vspublisher vspubdate">		
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
		<table width="145" border="0" cellpadding="0" cellspacing="0">
		<tr>
		<td width="145">&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br>
&nbsp;&nbsp;<INPUT type="radio" name="scope" value="" checked><FONT face="arial, helvetica" size="1" color="#ffffff" size="1">All ITKnowledge</FONT><br>
&nbsp;&nbsp;<INPUT type="radio" name="scope" value="sourcecode"><FONT face="arial, helvetica" size="1" color="#ffffff" size="1">Source Code</FONT><br>
			<font face="arial, helvetica" size="2">
			<img src="/images/dotclear.gif" width="1" height="5" alt="" border="0"><br>
			
			&nbsp;&nbsp;<a href="/search/search-tips.html"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Search Tips</font></a><br>
			&nbsp;&nbsp;<a href="/search/"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Advanced Search</font></a><br>
			
			</font>
			
		</td>
		<td width="5"><img src="/images/dotclear.gif" width=5 height=10 hspace="5" alt="" border="0"></td>
		</tr>
		</table>
	</form>
		
		
<!-- BROWSE BY TOPIC -->
		

<form name="meta" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewmetak2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<img src="/images/publication_searcha.gif" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="allbooks_p2">
<INPUT type="hidden" name="altcoll" value="corpitk_p2">
<INPUT type="hidden" name="topics" value="itk_www">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="vspubdate desc score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vspublisher vspubdate">
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
<table width="145" border="0" cellpadding="0" cellspacing="0">
	
			<tr>
			<td valign="top">
			&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br><font face="arial, helvetica" size="2">
			&nbsp;&nbsp;<SELECT NAME="metatags" style="font-size: 12; font-family: sans-serif;" size="1">
			<option value="vstitle" SELECTED>Title
			<option value="vsauthor">Author
			<option value="vspublisher">Publisher
			<option value="vsisbn">ISBN			
			</SELECT><br><br></font>
			</td>
			</tr>
</table>
</form>

<form action="" name="catlist">	
<table width="145" border="0" cellpadding="0" cellspacing="0">				
			<tr>
			<td valign="top">
			<img src="/images/jump_topica.gif" width="145" alt="" border="0">
			</td>
			</tr>
			<tr>
			<td width="145">
				
	        	<font face="Arial,helvetica" size="1">
				&nbsp;&nbsp;<SELECT NAME="cat" onChange='top.location.href=this.options[selectedIndex].value;' style="font-size: 10; font-family: sans-serif;">
                        <option value="" selected>Please Select
                        <option value="">-----------
						<option value="/reference/dir.1-busman.html">Business &amp; IT Mgmt
						<option value="/reference/dir.2-certification.html">Certification &amp; Training                       
						<option value="/reference/dir.3-databaseanderp.html">Database &amp; ERP
                        <option value="/reference/dir.4-desktopapps.html">Desktop Apps
                        <option value="/reference/dir.5-desktoppubanddesign.html">Graphic Design
                        <option value="/reference/dir.6-generalinternet.html">General Internet
                        <option value="/reference/dir.7-hardwareandos.html">Hardware &amp; OS
                        <option value="/reference/dir.8-ibmredbooks.html">IBM RedBooks
                        <option value="/reference/dir.9-networktelcom.html">Network &amp; Telecom
						<option value="/reference/dir.10-websoftwaredev.html">Web &amp; Software Dev
                        <option value="">-----------

                        <option value="/reference/dir.archive1.html">Public Archive               
                        </SELECT>
			</font>
			
		</td>
		</tr>
	</table>
	</form>
	
<!-- LEFT NAV SEARCH END -->

	</td>
		

<!-- END LEFT NAVBAR -->


<!-- END LEFT NAVBAR -->
	
	<td width="15"><img src="/images/dotclear.gif" width="15" alt="" border="0"></td>

<!-- end of ITK left NAV -->

<!-- begin main content -->
	
	<td width="100%" valign="top" align="left">
		<br>

<!-- END SUB HEADER -->
<!-- Created by dB Page Builder.  http://www.pchelponline.com/bluestem -->

<!--Begin Content Column -->

<TABLE border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img src="/images/sm_covers/1576104265.gif" width=60 height=73 alt="Perl Core Language Little Black Book" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Perl Core Language Little Black Book</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Steven Holzner</i>
    <br>
    The Coriolis Group
    <br>
    <b>ISBN:</b>&nbsp;1576104265<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;03/01/99</font>&nbsp;&nbsp;<A HREF="http://www.digitalguru.com/dgstore/product.asp?isbn=1576104265&ac%5Fid=28" TARGET="anotherwindows"><img src="/images/buyit.gif" width=64 height=23 hspace="5" align="middle" alt="Buy It" border="0"></a><a href="/PSUser/EWBookMarks.html?url=http://www.itknowledge.com/reference/standard/1576104265/ewtoc.html&isbn=1576104265"><img src="/images/bookmarkit.gif" border=0 align="middle" alt="Bookmark It" width=97 height=23></a>
</td>
</tr>
</table>
<P>
<FORM name= "search2" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewintrak2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<INPUT type="hidden" name="collection" value="corpitk_p2">
<INPUT type="hidden" name="altcoll" value="allbooks_p2">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="score desc">
<INPUT name="fields" type=hidden value="vdkvgwkey score vstitle vsisbn vsauthor vspublisher vspubdate">
<INPUT name="imageprefix" type=hidden value="http://www.itknowledge.com">
<INPUT name="ssiFolder" type=hidden value="itk">
<INPUT name="topics" type=hidden value="itk_www">
<INPUT type="hidden" name="bookid" value="t_1576104265">
<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="query" size=25 VALUE="">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle>

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=1576104265//-->
<!--TITLE=Perl Core Language Little Black Book//-->
<!--AUTHOR=Steven Holzner//-->
<!--PUBLISHER=The Coriolis Group//-->
<!--CHAPTER=21//-->
<!--PAGES=452-457//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="21-01.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="21-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>Also, because many users access the chat data files at the same time, this script locks files with <B>flock</B> while reading or writing to them to avoid conflicts. This is an exclusive lock instead of a shared lock, even for reading files, because that&#146;s proven the safest on the many different systems available (some of which don&#146;t implement shared locks successfully, as practical experience has shown). When you use <B>flock</B> to create an exclusive lock on a file in Perl, no other program can use <B>flock</B> to get a lock on that file until you&#146;ve unlocked the file. That doesn&#146;t necessarily mean other programs can&#146;t use the file (in Unix, for example, they can)&#151;it just means that they can&#146;t get a value of true from <B>flock</B>. This script uses <B>flock</B> to coordinate file access between users, waiting until it can get a value of true from <B>flock</B> before using a file.</P>
<I><P><A NAME="Fig1"></A><A HREF="javascript:displayWindow('images/21-01.jpg',631,495 )"><IMG SRC="images/21-01t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/21-01.jpg',631,495)"><FONT COLOR="#000077"><B>Figure 21.1</B></FONT></A>&nbsp;&nbsp;A multiuser chat example.</I>
</P>
<P>If this script finds itself blocked from accessing the chat data files, it keeps trying ten times a second for five seconds; if that doesn&#146;t work, there&#146;s something wrong, and the message &#147;Server too busy&#148; appears until the script can get access again.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading7"></A><FONT COLOR="#000077">Handling Denial Of Service Attacks</FONT></H4>
<P>A denial of service attack does just what its name implies&#151;denies service to users. One common form of a denial of service attack is to overload the system&#146;s resources, and CGI.pm is susceptible to this when a user posts a huge amount of data to a script or uploads a huge file. To handle these kinds of attacks to some extent, you can set the variable <B>$CGI::POST_MAX</B> to a nonnegative integer. This variable puts an upper limit in bytes on the size of posts.</P>
<I><B><BLOCKQUOTE>
<P><FONT SIZE="-1"><HR><B>WARNING!:&nbsp;&nbsp;</B>Note that the chat application isn&#146;t built to exclude access to anyone&#151;if you want to do so, make sure you add a password front end to the application.</B></I>
</FONT><HR>
</BLOCKQUOTE>
<H4 ALIGN="LEFT"><A NAME="Heading8"></A><FONT COLOR="#000077">Chatting From A Web Browser</FONT></H4>
<P>Here&#146;s how the application works: The user navigates to chat.htm, which creates two frames. The top frame displays the current chat text with a script named chat1.cgi, and the bottom frame uses another script, chat2.cgi, to display a text area the user can enter text into and a submit button to post that text. The top frame uses a meta HTTP tag to make the browser refresh that frame every five seconds.
</P>
<P>To install this application, you need to place chat.htm, chat1.cgi, chat2.cgi, and two data files: chat1.dat and chat2.dat, in the same directory.</P>
<P>You&#146;ll find chat.htm in Listing 21.1, chat1.cgi in Listing 21.2, and chat2.cgi in Listing 21.3. You create the data files chat1.dat and chat2.dat yourself&#151;just create files with these names, put in some brief sample text, and set their permissions low enough so the CGI scripts, chat1.cgi and chat2.cgi, can read from and write to them. To start chatting, the user just has to open chat.htm.</P>
<P>The chat application uses the two data files to store the two most recent chat entries. (I used separate text files for each chat text entry to make the text storage more secure in terms of file locking and the application as a whole more robust.) If you prefer, you can alter the code to work with more than two data files and so display more than just the last two chat entries.</P>
<H4 ALIGN="LEFT"><A NAME="Heading9"></A><FONT COLOR="#000077">Setting An HTML Page&#146;s Refresh Rate</FONT></H4>
<P>One thing you might want to customize is the five-second refresh period that this application uses. You can change that in this line in chat1.cgi; just substitute the number of seconds you want to use:
</P>
<!-- CODE SNIP //-->
<PRE>
&#147;&ltmeta HTTP-EQUIV=\&#147;Refresh\&#148; CONTENT=\&#147;5\&#148;&gt&#148;,
</PRE>
<!-- END CODE SNIP //-->
<H4 ALIGN="LEFT"><A NAME="Heading10"></A><FONT COLOR="#000077">Clearing Refreshed HTML Controls</FONT></H4>
<P>There&#146;s one more point to make, and it concerns CGI.pm. When a user posts a form with controls that have data in them and your script returns the same form, CGI.pm copies the data from the old controls to the new ones by default. In other words, say a form includes this text area:
</P>
<!-- CODE SNIP //-->
<PRE>
 $co-&gttextarea(
     -name=&gt&#145;textarea&#146;,
     -default=&gt&#145;&#146;,
     -rows=&gt4,
     -columns=&gt40
 )
</PRE>
<!-- END CODE SNIP //-->
<P>If the user places text in this text area and posts it to your script, the script can read the text with standard CGI methods. However, when you return the Web page with the same form, CGI.pm restores the original text to the text area (even though you&#146;ve set the text area&#146;s default text to an empty string). In the chat application, the result is that when a user posts text, that text will be accepted, but it doesn&#146;t disappear from the text area. To make CGI.pm respect the default value you specified in a case like this, you set the <B>-override</B> attribute to true:</P>
<!-- CODE SNIP //-->
<PRE>
 $co-&gttextarea(
     -name=&gt&#145;textarea&#146;,
     -default=&gt&#145;&#146;,
     -override=&gt1,
     -rows=&gt4,
     -columns=&gt40
 )
</PRE>
<!-- END CODE SNIP //-->
<P>Now the text area is cleared after the user&#146;s comments are read, which is what you&#146;d expect.
</P>
<P><B><I>Listing 21.1</B> chat.htm.</I></P>
<!-- CODE //-->
<PRE>
 &ltHTML&gt
 &ltHEAD&gt
 &ltTITLE&gtChat&lt/TITLE&gt
 &ltFRAMESET ROWS=&#147;150,*&#148;&gt
     &ltNOFRAMES&gtSorry, you need frames to use chat.&lt/NOFRAMES&gt
     &ltFRAME NAME=&#147;_display&#148; SRC=&#147;chat1.cgi&#148;&gt
     &ltFRAME NAME=&#147;_data&#148; SRC=&#147;chat2.cgi&#148;&gt
 &lt/FRAMESET&gt
 &lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P><B><I>Listing 21.2</B> chat1.cgi.</I></P>
<!-- CODE //-->
<PRE>
 #!/usr/bin/perl
 use CGI;
 use Fcntl;

 $co = new CGI;
 open (DATA1,&#147;&ltchat1.dat&#148;) or die&#147;Could not open data
     file.&#148;;
 lockfile(DATA1);
 $text1 = &ltDATA1&gt;
 unlockfile(DATA1);
 close DATA1;
 open (DATA2,&#147;&ltchat2.dat&#148;) or die&#147;Could not open data
     file.&#148;;
 lockfile(DATA2);
 $text2 = &ltDATA2&gt;
 unlockfile(DATA2);
 close DATA2;

 print
 $co-&gtheader,
&#147;&ltmeta HTTP-EQUIV=\&#148;Refresh\&#147; CONTENT=\&#148;5\&#147;&gt&#148;,
 $co-&gtstart_html(
     -title=&gt&#145;Chat Example&#146;,
     -author=&gt&#146;Steve&#146;,
     -target=&gt&#145;_display&#146;,
     -BGCOLOR=&gt&#145;white&#146;,
     -LINK=&gt&#145;red&#146;
 ),
 $co-&gtcenter($co-&gth1(&#145;Multi-User Chat&#146;)),
 $co-&gtp,
 $co-&gtp,
 $co-&gtcenter($text1),
 $co-&gtp,
 $co-&gtcenter($text2),
 $co-&gtend_html;
 exit;
 sub lockfile
 {
     my $count = 0;
     my $handle = shift;
     until (flock($handle, 2)) {
         sleep .10;
         if(&#43;&#43;$count &gt 50) {
             print
                $co-&gtheader,
               &#147;&ltmeta HTTP-EQUIV=\&#148;Refresh\&#147; CONTENT=\&#148;5\&#147;&gt&#148;,
                $co-&gtstart_html(
                    -title=&gt&#145;Chat Example&#146;,
                    -author=&gt&#145;Steve&#146;,
                    -target=&gt&#145;_display&#146;,
                    -BGCOLOR=&gt&#145;white&#146;,
                ),
                $co-&gtcenter($co-&gth1(&#145;Server too busy&#146;)),
                $co-&gtend_html;
             exit;
         }
     }
 }
 sub unlockfile
 {
     my $handle = shift;
     flock($handle, 8);
 }
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="21-01.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="21-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>

<hr width="90%" size="1" noshade>
<div align="center">
<font face="Verdana,sans-serif" size="1">Copyright &copy; <a href="/reference/tcg00001.html">The Coriolis Group, Inc.</a></font>
</div>
<!-- all of the reference materials (books) have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- BEGIN SUB FOOTER -->
	<br>
	<img src="/images/dotclear.gif" width="5" height="7" border="0">
	</TD>
    </TR>
	</TABLE>
	
	<table width="100%" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width="160"><img src="/images/bot_curve.jpg" width="160" alt="" border="0"></td>
		<td align="left" valign="top" nowrap><a href="/index2.html"><img src="/images/top_tabs/home_bot.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/account_info_bot.gif" alt="Account Info" border="0"></a><a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe_bot.gif" alt="Subscribe" border="0"></a><a href="/PSUser/psuserauth.htm?cmd=login&URI=/"><img src="/images/top_tabs/login_bot.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search_bot.gif" alt="Search" border="0"></a><a href="/PSUser/EWIPOMain.html"><img src="/images/top_tabs/my_itknowledge_bot.gif" alt="My ITKnowledge" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq_bot.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap_bot.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us_bot.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	</table>
		
	<table width="100%" bgcolor="#003366" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width=145><img src="/images/clear_pixel.gif" width=145 height="1" alt="" border="0"></td>
				
<!-- END SUB FOOTER -->

<!-- all of the books have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- FOOTER -->
			
<td align="left" bgcolor="#003366">
<table border="0" cellspacing="10" cellpadding="5">
<tr>
<td align="center">
<font face="arial, helvetica" size="1" color="#cccccc"><b><a href="/products.html"><font color="#0099CC">Products</font></a>&nbsp;|&nbsp; <a href="/contactus.html"><font color="#0099CC">Contact Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/dlink.corp|about_us-jhtml.72.0.-.0.jhtml" target="resource window"><font color="#0099CC">About Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/dlink.corp|privacy-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">Privacy</font></a> &nbsp;|&nbsp; <a href="http://www.itmarketer.com/" target="resource window"><font color="#0099CC">Ad Info</font></a> &nbsp;|&nbsp; <a href="/index2.html"><font color="#0099CC">Home</font></a></b>
<br><br>Use of this site is subject to certain <a href="/agreement.html"><font color="#0099CC">Terms &amp; Conditions</font></a>, <a href="/copyright.html"><font color="#0099CC">Copyright &copy; 1996-2000 EarthWeb Inc.</font></a> All rights reserved.  Reproduction in whole or in part in any form or medium without express written <a href="http://www.earthweb.com/dlink.corp|permissions-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">permission</font></a> of EarthWeb is prohibited. Read EarthWeb's <A HREF="http://www.earthweb.com/dlink.corp|privacy-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">privacy</font></A> statement.</font><br><br>
</td>
</tr>
</table>

<!-- netranger link to stop spiders -->

<a href="ITKN1a2b3c4d5e6f7g8h9idefcon4.html">
<img src="/images/dotclear.gif" border="0" height="1" width="1" align="left"></a>
</td>
		</tr>
</table>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev1;sz=468x60;ord=' + ord + '" width=468 height=60 visibility="hidden" onLoad="moveToAbsolute(layer1.pageX,layer1.pageY);clip.height=60;clip.width=468; visibility=\'show\';"></LAYER>');
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev4;sz=160x60;ord=' + ord + '" width=160 height=60 visibility="hidden" onLoad="moveToAbsolute(layer4.pageX,layer4.pageY);clip.height=60;clip.width=160; visibility=\'show\';"></LAYER>');
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev3;sz=125x125;ord=' + ord + '" width=125 height=125 visibility="hidden" onLoad="moveToAbsolute(layer3.pageX,layer3.pageY);clip.height=125;clip.width=125; visibility=\'show\';"></LAYER>');
//-->
</SCRIPT>
</BODY>
</HTML>

<!-- END FOOTER -->

