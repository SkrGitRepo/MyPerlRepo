<HTML>
<HEAD>
<META name=vsisbn content="1576104265">
<META name=vstitle content="Perl Core Language Little Black Book">
<META name=vsauthor content="Steven Holzner">
<META name=vspublisher content="The Coriolis Group">
<META name=vspubdate content="03/01/99">
<META name=vscategory content="Web and Software Development: Open Source Development: Languages: Perl,Web and Software Development: Programming, Scripting, and Markup Languages: Perl">





<TITLE>Perl Core Language Little Black Book:CGI: Web Counters, Guest Books, Emailers, And Secure Scripts</TITLE>

<!-- HEADER -->

<STYLE type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
</STYLE>

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
         var Win = window.open(url,"displayWindow",'width=' + width +',height=' + height + ',resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</script>
<SCRIPT>
<!--
function popUp(url) {
        var Win = window.open(url,"displayWindow",'width=400,height=300,resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</SCRIPT>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//-->
</script>

<SCRIPT LANGUAGE="JavaScript">
<!--
var axel = Math.random() + "";
var ord = axel * 1000000000000000000 + "?";

//This part of script alleviates a Netscape document.write bug
<!-- 
NS4 = document.layers;
if (NS4) {
origWidth = innerWidth;
origHeight = innerHeight;
}
function reDo() {
if (innerWidth != origWidth || innerHeight != origHeight) 
location.reload();
}
if (NS4) onresize = reDo;
//-->
</SCRIPT> 
</HEAD>

<body background="/images/back.jpg" bgcolor="#FFFFFF" link="#003399" alink="#FF0000" vlink="#003399" topmargin=0 leftmargin=0 marginheight=0 marginwidth=0>

<table bgcolor="#003366" width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr valign="top">
		<td height="95">
		&nbsp;&nbsp;<a href="http://www.earthweb.com" target="resource window"><img src="/images/ew_logo.jpg" width="82" height="58" alt="EarthWeb" border="0"></a>&nbsp;&nbsp;&nbsp;</td>
		<td height=95">
		<table width="100%">
			<tr valign="top">
			<td bgcolor="#003366" nowrap>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<NOLAYER>');
document.write('<IFRAME SRC="http://ad.doubleclick.net/adi/itk.earthweb.dart/b_soft_dev;a=b_soft_dev1;sz=468x60;ord=' + ord + '" width="468" height="60" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no">');
document.write('<A HREF="http://ad.doubleclick.net/jump/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev1;sz=468x60;ord=' + ord + '" target="_top"><IMG SRC="http://ad.doubleclick.net/ad/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev1;sz=468x60;ord=' + ord + '" border=0 height="60" width="468"></A>');
document.write('</IFRAME>');
document.write('</NOLAYER>');
document.write('<ILAYER id="layer1" visibility="hidden" width=468 height=60></ILAYER>');
//-->
</SCRIPT>
			</td>
			<td bgcolor="#003366" nowrap>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<NOLAYER>');
document.write('<IFRAME SRC="http://ad.doubleclick.net/adi/itk.earthweb.dart/b_soft_dev;a=b_soft_dev4;sz=160x60;ord=' + ord + '" width="160" height="60" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no">');
document.write('<A HREF="http://ad.doubleclick.net/jump/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev4;sz=160x60;ord=' + ord + '" target="_top"><IMG SRC="http://ad.doubleclick.net/ad/itk.earthweb.dart/b_soft_dev;abr=!ie;a=b_soft_dev4;sz=160x60;ord=' + ord + '" border=0 height="60" width="160"></A>');
document.write('</IFRAME>');
document.write('</NOLAYER>');
document.write('<ILAYER id="layer4" visibility="hidden" width=160 height=60></ILAYER>');
//-->
</SCRIPT>
			</td>
			<td bgcolor="#003366" nowrap><a href="ITKN1a2b3c4d5e6f7g8h9idefcon4.html"><img src="/images/dotclear.gif" border="0" height="1" width="1" align="left"></a></td>
			</tr></table><br></td>
	</tr>
		
<!-- 	<tr>
		<td height="1" colspan="3" bgcolor="#003366"><img src="/images/dotclear.gif" border=0 alt=""></td>
	</tr> -->
</table>

<!-- END HEADER -->


<!-- BEGIN SUB HEADER -->

<table bgcolor="#003366" cellpadding="0" cellspacing="0" border="0" width="100%">

<!-- ITK TOPNAV -->
	
	<tr>
		<td align="left" valign="top" nowrap><a href="/index2.html"><img src="/images/top_tabs/home_off.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/accountinfo.gif" alt="Account Info" border="0"></a><!--<a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe.gif" alt="Subscribe" border="0"></a>--><a href="/PSUser/psuserauth.htm?cmd=login&URI=/"><img src="/images/top_tabs/login.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search.gif" alt="Search" border="0"></a><a href="/PSUser/EWIPOMain.html"><img src="/images/top_tabs/my_itknowledge.gif" alt="My ITKnowledge" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	
<!-- END of ITK TOPNAV -->

<!-- ITK LOGO and newsletter sign up -->

</table>
	
<table cellpadding="0" cellspacing="0" border="0" width="100%">

	<tr>
		<td align="left" valign="top" nowrap><img src="/images/itk_logo_sm.jpg" alt="" border="0"></td>
		<td align="right"><font face="verdana, sans-serif" size="1">

<script language="JavaScript">
<!-- 

var days = new Array(8);
days[1] = "Sunday";
days[2] = "Monday";
days[3] = "Tuesday";
days[4] = "Wednesday";
days[5] = "Thursday";
days[6] = "Friday";
days[7] = "Saturday";

var months = new Array(13);
months[1] = "January";
months[2] = "February";
months[3] = "March";
months[4] = "April";
months[5] = "May";
months[6] = "June";
months[7] = "July";
months[8] = "August";
months[9] = "September";
months[10] = "October";
months[11] = "November";
months[12] = "December";

var dateObj = new Date()
var wday = days[dateObj.getDay() + 1]
var lmonth = months[dateObj.getMonth() + 1]
var date = dateObj.getDate()
var fyear = dateObj.getYear()
if (fyear <1000) fyear += 1900;
document.write(wday + ", " + lmonth + " " + date + ", " + fyear)
                
//-->
</script>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<br><br>


		 </td>
	</tr>
	</table>

<!-- END ITK LOGO and newsletter sign up-->
	
<!-- begin of ITK left NAV -->

<!-- BEGIN LEFT NAVBAR -->

<!-- BEGIN LEFT NAVBAR -->

	<table border="0" cellpadding="0" cellspacing="0">
	
	
		<tr>
		<td width="145" valign="top" align="left" rowspan=8>
		
	<!-- KEYWORD SEARCH -->	
<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//-->
</script>
	
	
	<form name="keyword" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewkwk2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<img src="/images/keyword_searcha.gif" vspace="5" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="corpitk_p2">
<INPUT type="hidden" name="altcoll" value="allbooks_p2">
<INPUT type="hidden" name="topics" value="itk_www">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="vspubdate desc score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vsisbn vspublisher vspubdate">		
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
		<table width="145" border="0" cellpadding="0" cellspacing="0">
		<tr>
		<td width="145">&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br>
&nbsp;&nbsp;<INPUT type="radio" name="scope" value="" checked><FONT face="arial, helvetica" size="1" color="#ffffff" size="1">All ITKnowledge</FONT><br>
&nbsp;&nbsp;<INPUT type="radio" name="scope" value="sourcecode"><FONT face="arial, helvetica" size="1" color="#ffffff" size="1">Source Code</FONT><br>
			<font face="arial, helvetica" size="2">
			<img src="/images/dotclear.gif" width="1" height="5" alt="" border="0"><br>
			
			&nbsp;&nbsp;<a href="/search/search-tips.html"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Search Tips</font></a><br>
			&nbsp;&nbsp;<a href="/search/"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Advanced Search</font></a><br>
			
			</font>
			
		</td>
		<td width="5"><img src="/images/dotclear.gif" width=5 height=10 hspace="5" alt="" border="0"></td>
		</tr>
		</table>
	</form>
		
		
<!-- BROWSE BY TOPIC -->
		

<form name="meta" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewmetak2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<img src="/images/publication_searcha.gif" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="allbooks_p2">
<INPUT type="hidden" name="altcoll" value="corpitk_p2">
<INPUT type="hidden" name="topics" value="itk_www">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="vspubdate desc score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vspublisher vspubdate">
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
<table width="145" border="0" cellpadding="0" cellspacing="0">
	
			<tr>
			<td valign="top">
			&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br><font face="arial, helvetica" size="2">
			&nbsp;&nbsp;<SELECT NAME="metatags" style="font-size: 12; font-family: sans-serif;" size="1">
			<option value="vstitle" SELECTED>Title
			<option value="vsauthor">Author
			<option value="vspublisher">Publisher
			<option value="vsisbn">ISBN			
			</SELECT><br><br></font>
			</td>
			</tr>
</table>
</form>

<form action="" name="catlist">	
<table width="145" border="0" cellpadding="0" cellspacing="0">				
			<tr>
			<td valign="top">
			<img src="/images/jump_topica.gif" width="145" alt="" border="0">
			</td>
			</tr>
			<tr>
			<td width="145">
				
	        	<font face="Arial,helvetica" size="1">
				&nbsp;&nbsp;<SELECT NAME="cat" onChange='top.location.href=this.options[selectedIndex].value;' style="font-size: 10; font-family: sans-serif;">
                        <option value="" selected>Please Select
                        <option value="">-----------
						<option value="/reference/dir.1-busman.html">Business &amp; IT Mgmt
						<option value="/reference/dir.2-certification.html">Certification &amp; Training                       
						<option value="/reference/dir.3-databaseanderp.html">Database &amp; ERP
                        <option value="/reference/dir.4-desktopapps.html">Desktop Apps
                        <option value="/reference/dir.5-desktoppubanddesign.html">Graphic Design
                        <option value="/reference/dir.6-generalinternet.html">General Internet
                        <option value="/reference/dir.7-hardwareandos.html">Hardware &amp; OS
                        <option value="/reference/dir.8-ibmredbooks.html">IBM RedBooks
                        <option value="/reference/dir.9-networktelcom.html">Network &amp; Telecom
						<option value="/reference/dir.10-websoftwaredev.html">Web &amp; Software Dev
                        <option value="">-----------

                        <option value="/reference/dir.archive1.html">Public Archive               
                        </SELECT>
			</font>
			
		</td>
		</tr>
	</table>
	</form>
	
<!-- LEFT NAV SEARCH END -->

	</td>
		

<!-- END LEFT NAVBAR -->


<!-- END LEFT NAVBAR -->
	
	<td width="15"><img src="/images/dotclear.gif" width="15" alt="" border="0"></td>

<!-- end of ITK left NAV -->

<!-- begin main content -->
	
	<td width="100%" valign="top" align="left">
		<br>

<!-- END SUB HEADER -->
<!-- Created by dB Page Builder.  http://www.pchelponline.com/bluestem -->

<!--Begin Content Column -->

<TABLE border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img src="/images/sm_covers/1576104265.gif" width=60 height=73 alt="Perl Core Language Little Black Book" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Perl Core Language Little Black Book</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Steven Holzner</i>
    <br>
    The Coriolis Group
    <br>
    <b>ISBN:</b>&nbsp;1576104265<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;03/01/99</font>&nbsp;&nbsp;<A HREF="http://www.digitalguru.com/dgstore/product.asp?isbn=1576104265&ac%5Fid=28" TARGET="anotherwindows"><img src="/images/buyit.gif" width=64 height=23 hspace="5" align="middle" alt="Buy It" border="0"></a><a href="/PSUser/EWBookMarks.html?url=http://www.itknowledge.com/reference/standard/1576104265/ewtoc.html&isbn=1576104265"><img src="/images/bookmarkit.gif" border=0 align="middle" alt="Bookmark It" width=97 height=23></a>
</td>
</tr>
</table>
<P>
<FORM name= "search2" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewintrak2search_p2.jsp" onSubmit=" return checkForQuery(this); ">
<INPUT type="hidden" name="collection" value="corpitk_p2">
<INPUT type="hidden" name="altcoll" value="allbooks_p2">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="score desc">
<INPUT name="fields" type=hidden value="vdkvgwkey score vstitle vsisbn vsauthor vspublisher vspubdate">
<INPUT name="imageprefix" type=hidden value="http://www.itknowledge.com">
<INPUT name="ssiFolder" type=hidden value="itk">
<INPUT name="topics" type=hidden value="itk_www">
<INPUT type="hidden" name="bookid" value="t_1576104265">
<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="query" size=25 VALUE="">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle>

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=1576104265//-->
<!--TITLE=Perl Core Language Little Black Book//-->
<!--AUTHOR=Steven Holzner//-->
<!--PUBLISHER=The Coriolis Group//-->
<!--CHAPTER=20//-->
<!--PAGES=434-439//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="20-01.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="20-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>You used to turn on taint checks in Perl 4 by using a special version of the Perl interpreter named taintperl:
</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/taintperl
</PRE>
<!-- END CODE SNIP //-->
<P>However, in version 5, taint checking is built in, and you enable it by passing the <B>-T</B> switch to the Perl interpreter:</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/perl -T
</PRE>
<!-- END CODE SNIP //-->
<P>Here&#146;s an example in which I turn taint checking on but do nothing dangerous, so there&#146;s no problem:
</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/perl -T
print &#147;Hello!\n&#148;;

<I>Hello!</I>
</PRE>
<!-- END CODE SNIP //-->
<P>However, if you use potentially dangerous statements like the <B>system</B> statement with taint checking on, Perl will advise you of a possible security hole coming from environment data; even if you don&#146;t rely on the path when you invoke an external program, there&#146;s a chance that the invoked program might. Here&#146;s the error message you&#146;ll see:</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/perl -T
print system(&#145;date&#146;);

<I>Insecure $ENV{PATH} while running with -T switch at
taint.cgi line 5, &lt&gt chunk 1.</I>
</PRE>
<!-- END CODE SNIP //-->
<P>To fix this, you can explicitly set <B>$ENV{&#145;PATH&#146;}</B> yourself when you use taint checks:</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/perl -T
$ENV{&#145;PATH&#146;} = &#145;/bin:/usr/bin:/usr/local/bin&#146;;
print system(&#145;date&#146;);

<I>Thu Nov 12 19:55:53 EST</I>
</PRE>
<!-- END CODE SNIP //-->
<P>Here&#146;s another example in which I try a system call with tainted data; even though I set <B>$ENV{&#145;PATH&#146;}</B>, the script still dies because it tries to pass tainted data to the system statement:</P>
<!-- CODE SNIP //-->
<PRE>
#!/usr/local/bin/perl -T
$ENV{&#145;PATH&#146;} = &#145;/bin:/usr/bin:/usr/local/bin&#146;;
while (&lt&gt) {
   $command = $_;
   system($command);
}
<I>Insecure dependency in system while running with -T switch
at taint.cgi line 5, &lt&gt chunk 1.</I>
</PRE>
<!-- END CODE SNIP //-->
<P>Note that, as shown here, even though the data is assigned from <B>$_</B> to <B>$command</B>, it&#146;s still tainted. How can you untaint data if you&#146;re sure of it? See the next topic.</P>
<H4 ALIGN="LEFT"><A NAME="Heading5"></A><FONT COLOR="#000077">Untainting Data</FONT></H4>
<P>The only way to untaint a tainted variable is by using pattern matching to extract substrings from the tainted variable. Here&#146;s an example in which we expect a tainted variable, <B>$tainted</B>, to hold an email address. We might extract that address and store it as untainted data this way:</P>
<!-- CODE SNIP //-->
<PRE>
$tainted =~ /(^[\w]&#43;)\@([\w.]&#43;)/;
$username = $1;
$domain = $2;
print &#147;$username\n&#148;;
print &#147;$domain\n&#148;;
</PRE>
<!-- END CODE SNIP //-->
<P>In this way, we&#146;ve extracted safe data from a tainted variable. That&#146;s the way you create untainted data&#151;by extracting substrings you know to be safe (and explicitly avoiding shell metacharacters) from tainted data.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading6"></A><FONT COLOR="#000077">Giving A CGI Script More Privileges In Unix</FONT></H4>
<P>Because your CGI scripts run in Unix under the system ID as &#147;nobody,&#148; they don&#146;t have a lot of privileges. You might want more privileges to let your script perform certain operations, such as creating files. You can give your CGI script more privileges, but this is such an unsecured operation that you should consider all other possible options first, then only do it with extreme care.
</P>
<P>You can run a Perl script as <I>suid,</I> which means it will have the same privileges as its owner (that is, you). Note that you must have a really good reason for doing this and should remove these privileges as soon as practical. You can make a script run as suid by setting its <B>s</B> bit with <B>chmod:</B></P>
<!-- CODE SNIP //-->
<PRE>
chmod u&#43;s script1.pl
</PRE>
<!-- END CODE SNIP //-->
<P>You can also make a script run with its owner&#146;s group privileges by setting the <B>s</B> bit in its group field with <B>chmod:</B></P>
<!-- CODE SNIP //-->
<PRE>
chmod g&#43;s script1.pl
</PRE>
<!-- END CODE SNIP //-->
<P>Note, however, that a number of Unix systems have a subtle security hole that allows suid scripts to be used for hostile purposes. How can you tell if you&#146;re on such a system? If you are, you&#146;ll get an error message from Perl if you try to execute a script with its suid bits set.
</P>
<I><B><BLOCKQUOTE>
<P><FONT SIZE="-1"><HR><B>WARNING!:&nbsp;&nbsp;</B>Most operations can be performed in a safe way without running scripts such as suid. This topic is included only for completeness. If you do upgrade the permission of CGI scripts this way, make very sure you know what you&#146;re doing, and never leave such scripts unwatched.</B>
</I>
</FONT><HR>
</BLOCKQUOTE>
<H4 ALIGN="LEFT"><A NAME="Heading7"></A><FONT COLOR="#000077">Creating A Web Counter</FONT></H4>
<P>Creating a Web counter script isn&#146;t difficult: you only have to store the current count in a file and display that count as required. I&#146;ll create an example Web counter named counter.cgi here.
</P>
<I><BLOCKQUOTE>
<P><FONT SIZE="-1"><HR><B>TIP:&nbsp;&nbsp;</B>Note that this Web counter simply displays the current count as a text string, but you can do fancier things. For example, you can create a graphical Web count if you use a set of image files that display digits and display these digits immediately next to each other in a Web page. You can display each digit with an <B>&ltIMG&gt</B> tag if you set its <B>SRC</B> attribute to the URL of the appropriate digit-displaying script.</I>
</FONT><HR>
</BLOCKQUOTE>
<P>This script is called counter.cgi, and it appears in Listing 20.1. To use it, you must create a file named counter.dat in the same directory as counter.cgi; to start the count, place 0 (zero) in counter.dat using a text editor, and make that file&#146;s permission low enough to be able to be written to by CGI scripts on your system. (Avoid trying to create counter.dat from the script if that file doesn&#146;t exist because your system probably won&#146;t let CGI scripts running under default privileges create files in your directories.)
</P>
<P><B><I>Listing 20.1</B> counter.cgi.</I></P>
<!-- CODE //-->
<PRE>
#!/usr/bin/perl
use CGI;

$co = new CGI;

open (COUNT, &#147;&ltcounter.dat&#148;) or die &#147;Could not open counter
    data file.&#148;;
$count = &ltCOUNT&gt;
close COUNT;

$count&#43;&#43;;

open (COUNT, &#147;&gtcounter.dat&#148;);
print COUNT $count;
close COUNT;

print
$co-&gtheader,
$co-&gtstart_html(
    -title=&gt&#145;Counter Example&#146;,
    -author=&gt&#145;Steve&#146;,
    -BGCOLOR=&gt&#145;white&#146;,
),

$co-&gtcenter($co-&gth1(&#145;Counter Example&#146;)),
$co-&gtp,
$co-&gtcenter($co-&gth3(&#147;Current count: &#148;, $count)),
$co-&gtp,
$co-&gtcenter($co-&gth3(&#147;Reload the page to update the count&#148;)),
$co-&gtend_html;
</PRE>
<!-- END CODE //-->
<P>This script is very easy: all it does is read the number in counter.dat, increment that number, write it back to counter.dat, then display the incremented count. The result appears in Figure 20.1.
</P>
<I><P><A NAME="Fig1"></A><A HREF="javascript:displayWindow('images/20-01.jpg',585,363 )"><IMG SRC="images/20-01t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/20-01.jpg',585,363)"><FONT COLOR="#000077"><B>Figure 20.1</B></FONT></A>&nbsp;&nbsp;The Web page counter.</I>
</P>
<H4 ALIGN="LEFT"><A NAME="Heading8"></A><FONT COLOR="#000077">Creating A Guest Book</FONT></H4>
<P>Creating a guest book is one step up from creating a Web counter (see the previous topic). A guest book takes comments from users and stores them in a file, usually an HTML file, so these comments&#151;and comments entered by previous users&#151;can be displayed.
</P>
<P>This guest book uses three files, all of which are placed in the same directory by default: guestbook.htm, which appears in Listing 20.2; guestbook.cgi, which appears in Listing 20.3; and book.htm, which appears in Listing 20.4. The guestbook.htm file is the front end for the guest book&#151;that is, the page you direct users to so they can add to the guest book. That Web page takes the user&#146;s name and guest book comments, as shown in Figure 20.2. When the user clicks the submit button, the data is sent to guestbook.cgi, which means if you use this script, you should change the generic URL in guestbook.htm to point to your URL for guestbook.cgi:</P>
<!-- CODE SNIP //-->
<PRE>
&ltBODY&gt
&ltH1&gtAdd to the guestbook...&lt/H1&gt
&ltFORM METHOD = POST ACTION =
&#147;&lthttp://www.yourserver.com/username/cgi/guestbook.cgi&gt&#148;&gt;
&ltBR&gt
</PRE>
<!-- END CODE SNIP //-->
<I><P><A NAME="Fig2"></A><A HREF="javascript:displayWindow('images/20-02.jpg',631,553 )"><IMG SRC="images/20-02t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/20-02.jpg',631,553)"><FONT COLOR="#000077"><B>Figure 20.2</B></FONT></A>&nbsp;&nbsp;Creating a guest book comment.</I>
</P>
<P>In guestbook.cgi (see Listing 20.3), we open the guest book itself, which is stored in book.htm. The idea is to append the new name and comments to the end of book.htm, but note that book.htm ends with the usual <B>&lt/BODY&gt&lt/HTML&gt</B> tags. This means that we&#146;ll first move the file pointer to the start of these tags with this code:</P>
<!-- CODE SNIP //-->
<PRE>
open (BOOK, &#147;&gt&gtbook.htm&#148;) or die &#147;Could not open guest
    book.&#148;;
seek (BOOK, -length($co-&gtend_html), 2);
</PRE>
<!-- END CODE SNIP //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="20-01.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="20-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>

<hr width="90%" size="1" noshade>
<div align="center">
<font face="Verdana,sans-serif" size="1">Copyright &copy; <a href="/reference/tcg00001.html">The Coriolis Group, Inc.</a></font>
</div>
<!-- all of the reference materials (books) have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- BEGIN SUB FOOTER -->
	<br>
	<img src="/images/dotclear.gif" width="5" height="7" border="0">
	</TD>
    </TR>
	</TABLE>
	
	<table width="100%" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width="160"><img src="/images/bot_curve.jpg" width="160" alt="" border="0"></td>
		<td align="left" valign="top" nowrap><a href="/index2.html"><img src="/images/top_tabs/home_bot.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/account_info_bot.gif" alt="Account Info" border="0"></a><a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe_bot.gif" alt="Subscribe" border="0"></a><a href="/PSUser/psuserauth.htm?cmd=login&URI=/"><img src="/images/top_tabs/login_bot.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search_bot.gif" alt="Search" border="0"></a><a href="/PSUser/EWIPOMain.html"><img src="/images/top_tabs/my_itknowledge_bot.gif" alt="My ITKnowledge" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq_bot.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap_bot.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us_bot.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	</table>
		
	<table width="100%" bgcolor="#003366" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width=145><img src="/images/clear_pixel.gif" width=145 height="1" alt="" border="0"></td>
				
<!-- END SUB FOOTER -->

<!-- all of the books have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- FOOTER -->
			
<td align="left" bgcolor="#003366">
<table border="0" cellspacing="10" cellpadding="5">
<tr>
<td align="center">
<font face="arial, helvetica" size="1" color="#cccccc"><b><a href="/products.html"><font color="#0099CC">Products</font></a>&nbsp;|&nbsp; <a href="/contactus.html"><font color="#0099CC">Contact Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/dlink.corp|about_us-jhtml.72.0.-.0.jhtml" target="resource window"><font color="#0099CC">About Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/dlink.corp|privacy-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">Privacy</font></a> &nbsp;|&nbsp; <a href="http://www.itmarketer.com/" target="resource window"><font color="#0099CC">Ad Info</font></a> &nbsp;|&nbsp; <a href="/index2.html"><font color="#0099CC">Home</font></a></b>
<br><br>Use of this site is subject to certain <a href="/agreement.html"><font color="#0099CC">Terms &amp; Conditions</font></a>, <a href="/copyright.html"><font color="#0099CC">Copyright &copy; 1996-2000 EarthWeb Inc.</font></a> All rights reserved.  Reproduction in whole or in part in any form or medium without express written <a href="http://www.earthweb.com/dlink.corp|permissions-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">permission</font></a> of EarthWeb is prohibited. Read EarthWeb's <A HREF="http://www.earthweb.com/dlink.corp|privacy-jhtml.72.0.-.-.jhtml" target="resource window"><font color="#0099CC">privacy</font></A> statement.</font><br><br>
</td>
</tr>
</table>

<!-- netranger link to stop spiders -->

<a href="ITKN1a2b3c4d5e6f7g8h9idefcon4.html">
<img src="/images/dotclear.gif" border="0" height="1" width="1" align="left"></a>
</td>
		</tr>
</table>
<SCRIPT LANGUAGE="javascript">
<!--
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev1;sz=468x60;ord=' + ord + '" width=468 height=60 visibility="hidden" onLoad="moveToAbsolute(layer1.pageX,layer1.pageY);clip.height=60;clip.width=468; visibility=\'show\';"></LAYER>');
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev4;sz=160x60;ord=' + ord + '" width=160 height=60 visibility="hidden" onLoad="moveToAbsolute(layer4.pageX,layer4.pageY);clip.height=60;clip.width=160; visibility=\'show\';"></LAYER>');
document.write('<LAYER SRC="http://ad.doubleclick.net/adl/itk.earthweb.dart/b_soft_dev;a=b_soft_dev3;sz=125x125;ord=' + ord + '" width=125 height=125 visibility="hidden" onLoad="moveToAbsolute(layer3.pageX,layer3.pageY);clip.height=125;clip.width=125; visibility=\'show\';"></LAYER>');
//-->
</SCRIPT>
</BODY>
</HTML>

<!-- END FOOTER -->

